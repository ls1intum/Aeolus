!#/usr/bin/env bash

source ./cli/venv/bin/activate
directory="schemas"
latest_schema_version=$(ls -1v ${directory} | tail -n 1)
for schema in $(ls ${directory}/${latest_schema_version}/*.schema.json)
do
  filename=$(echo "$schema" | sed "s|$directory/$latest_schema_version/||" | sed "s|.schema.json||")
  echo "Generating $filename.py from $schema"
  datamodel-codegen --target-python-version 3.11 --reuse-model --use-schema-description --input ${schema} --input-file-type jsonschema --output cli/classes/generated/${filename}.py --output-model-type pydantic_v2.BaseModel
done

for schema in $(ls ${directory}/${latest_schema_version}/environment/*.schema.json)
do
  filename=$(echo "$schema" | sed "s|$directory/$latest_schema_version/environment||" | sed "s|.schema.json||")
  echo "Generating $filename.py from $schema"
  datamodel-codegen --target-python-version 3.11 --reuse-model --use-schema-description --input ${schema} --input-file-type jsonschema --output cli/classes/generated/${filename}.py --output-model-type pydantic_v2.BaseModel
done
